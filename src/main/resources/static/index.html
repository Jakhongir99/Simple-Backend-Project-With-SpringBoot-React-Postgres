<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PostgreSQL CRUD Application</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      .main-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        margin: 20px auto;
        max-width: 1200px;
      }
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 20px 20px 0 0;
        text-align: center;
      }
      .content {
        padding: 30px;
      }
      .card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }
      .card:hover {
        transform: translateY(-5px);
      }
      .btn {
        border-radius: 10px;
        padding: 10px 20px;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
      }
      .btn-success {
        background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        border: none;
      }
      .btn-warning {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        border: none;
      }
      .btn-danger {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        border: none;
      }
      .form-control {
        border-radius: 10px;
        border: 2px solid #e9ecef;
        padding: 12px 15px;
        transition: all 0.3s ease;
      }
      .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
      }
      .table {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }
      .table thead th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px;
      }
      .table tbody td {
        padding: 15px;
        vertical-align: middle;
      }
      .alert {
        border-radius: 10px;
        border: none;
      }
      .status-indicator {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 8px;
      }
      .status-online {
        background-color: #28a745;
      }
      .status-offline {
        background-color: #dc3545;
      }
      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }
      .spinner-border {
        width: 3rem;
        height: 3rem;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="main-container">
        <div class="header">
          <h1><i class="fas fa-database"></i> PostgreSQL CRUD Application</h1>
          <p class="mb-0">Modern Web Interface for Database Operations</p>
        </div>

        <div class="content">
          <div id="message"></div>

          <div class="row">
            <div class="col-lg-4">
              <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0">
                    <i class="fas fa-user-plus"></i> Add/Edit User
                  </h5>
                </div>
                <div class="card-body">
                  <form id="userForm">
                    <input type="hidden" id="userId" />
                    <div class="mb-3">
                      <label for="name" class="form-label">Name</label>
                      <input
                        type="text"
                        class="form-control"
                        id="name"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label for="email" class="form-label">Email</label>
                      <input
                        type="email"
                        class="form-control"
                        id="email"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label for="password" class="form-label">Password</label>
                      <input
                        type="password"
                        class="form-control"
                        id="password"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label for="phone" class="form-label">Phone</label>
                      <input type="text" class="form-control" id="phone" />
                    </div>
                    <div class="d-grid gap-2">
                      <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save User
                      </button>
                      <button
                        type="button"
                        class="btn btn-secondary"
                        onclick="clearForm()"
                      >
                        <i class="fas fa-eraser"></i> Clear
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <div class="col-lg-8">
              <div class="card">
                <div
                  class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
                >
                  <h5 class="mb-0">
                    <i class="fas fa-users"></i> Users Database
                  </h5>
                  <div>
                    <button onclick="loadUsers()" class="btn btn-light btn-sm">
                      <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button
                      onclick="addSampleData()"
                      class="btn btn-warning btn-sm"
                    >
                      <i class="fas fa-plus"></i> Add Sample Data
                    </button>
                  </div>
                </div>
                <div class="card-body">
                  <div class="loading" id="loading">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Loading users...</p>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-hover" id="usersTable">
                      <thead>
                        <tr>
                          <th>ID</th>
                          <th>Name</th>
                          <th>Email</th>
                          <th>Phone</th>
                          <th>Created</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="usersTableBody"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const API_BASE_URL = "/api/users";
      let users = [];

      function showMessage(message, type = "success") {
        const messageDiv = document.getElementById("message");
        messageDiv.innerHTML = `<div class="alert alert-${type} alert-dismissible fade show" role="alert">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>`;
        setTimeout(() => {
          messageDiv.innerHTML = "";
        }, 5000);
      }

      function showLoading(show) {
        document.getElementById("loading").style.display = show
          ? "block"
          : "none";
      }

      // Database status update function removed

      // Health check function removed

      async function loadUsers() {
        showLoading(true);
        try {
          const response = await fetch(API_BASE_URL);
          if (response.ok) {
            users = await response.json();
            displayUsers(users);
          } else {
            showMessage("Error loading users", "danger");
          }
        } catch (error) {
          showMessage("Error loading users: " + error.message, "danger");
        } finally {
          showLoading(false);
        }
      }

      function displayUsers(usersToShow) {
        const tbody = document.getElementById("usersTableBody");
        tbody.innerHTML = "";

        if (usersToShow.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="6" class="text-center text-muted">No users found</td></tr>';
          return;
        }

        usersToShow.forEach((user) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td><span class="badge bg-primary">${user.id}</span></td>
                    <td><strong>${user.name}</strong></td>
                    <td><i class="fas fa-envelope"></i> ${user.email}</td>
                    <td>${
                      user.phone || '<span class="text-muted">-</span>'
                    }</td>
                    <td><small>${new Date(
                      user.createdAt
                    ).toLocaleString()}</small></td>
                    <td>
                        <button onclick="editUser(${
                          user.id
                        })" class="btn btn-warning btn-sm">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button onclick="deleteUser(${
                          user.id
                        })" class="btn btn-danger btn-sm">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                `;
          tbody.appendChild(row);
        });
      }

      async function addSampleData() {
        const sampleUsers = [
          {
            name: "John Doe",
            email: "john@example.com",
            password: "password123",
            phone: "123-456-7890",
          },
          {
            name: "Jane Smith",
            email: "jane@example.com",
            password: "password456",
            phone: "098-765-4321",
          },
          {
            name: "Bob Johnson",
            email: "bob@example.com",
            password: "password789",
            phone: "555-123-4567",
          },
        ];

        for (const userData of sampleUsers) {
          try {
            await fetch(API_BASE_URL, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(userData),
            });
          } catch (error) {
            console.error("Error adding sample user:", error);
          }
        }

        showMessage("Sample data added successfully!");
        loadUsers();
      }

      async function editUser(id) {
        try {
          const response = await fetch(`${API_BASE_URL}/${id}`);
          if (response.ok) {
            const user = await response.json();

            document.getElementById("userId").value = user.id;
            document.getElementById("name").value = user.name;
            document.getElementById("email").value = user.email;
            document.getElementById("password").value = user.password;
            document.getElementById("phone").value = user.phone || "";

            showMessage("User loaded for editing");
          }
        } catch (error) {
          showMessage("Error loading user: " + error.message, "danger");
        }
      }

      async function deleteUser(id) {
        if (!confirm("Are you sure you want to delete this user?")) {
          return;
        }

        try {
          const response = await fetch(`${API_BASE_URL}/${id}`, {
            method: "DELETE",
          });

          if (response.ok) {
            showMessage("User deleted successfully");
            loadUsers();
          } else {
            showMessage("Error deleting user", "danger");
          }
        } catch (error) {
          showMessage("Error deleting user: " + error.message, "danger");
        }
      }

      function clearForm() {
        document.getElementById("userForm").reset();
        document.getElementById("userId").value = "";
      }

      document
        .getElementById("userForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const userId = document.getElementById("userId").value;
          const userData = {
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            password: document.getElementById("password").value,
            phone: document.getElementById("phone").value,
          };

          try {
            const url = userId ? `${API_BASE_URL}/${userId}` : API_BASE_URL;
            const method = userId ? "PUT" : "POST";

            const response = await fetch(url, {
              method: method,
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(userData),
            });

            if (response.ok) {
              const user = await response.json();
              showMessage(
                userId
                  ? "User updated successfully"
                  : "User created successfully"
              );
              clearForm();
              loadUsers();
            } else {
              showMessage("Error saving user", "danger");
            }
          } catch (error) {
            showMessage("Error saving user: " + error.message, "danger");
          }
        });

      // Initialize application
      window.onload = function () {
        loadUsers();
      };
    </script>
  </body>
</html>
